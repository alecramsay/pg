<!-- A tab for map index = [Official, {{ label }}, Competitive, Minority, Compact, Splitting] -->

{% assign label = site.data.maps[include.index].label %}
{% assign label-qualified = site.data.maps[include.index].qualified-label | downcase %}
{% assign label-lower = label | downcase %}

{% capture map-exists %}
{{ xx }}_2022_Congress_{{ label }}_map.png
{% endcapture %}
{% assign map-exists = map-exists | strip_newlines %}

{% capture map-png %}
{{ site.baseurl }}/assets/images/{{ xx }}_2022_Congress_{{ label }}_map.png
{% endcapture %}
{% assign map-png = map-png | strip_newlines %}

{% capture radar-png %}
{{ site.baseurl }}/assets/images/{{ xx }}_2022_Congress_{{ label }}_radar.png
{% endcapture %}
{% assign radar-png = radar-png | strip_newlines %}

{% capture intersections-png %}
{{ site.baseurl }}/assets/images/{{ xx }}_2022_Congress_{{ label }}_intersections_map.png
{% endcapture %}
{% assign intersections-png = intersections-png | strip_newlines %}

{% capture intersections-csv %}
{{ xx }}_2022_Congress_{{ label }}_intersections_summary
{% endcapture %}
{% assign intersections-csv = intersections-csv | strip_newlines %}
{% assign intersections = site.data[intersections-csv] %}

{% assign state = site.data.states | where:"xx", xx | first %}

{% capture baseline-link %}
https://davesredistricting.org/join/{{ state["baseline"] }}
{% endcapture %}
{% assign baseline-link = baseline-link | strip_newlines %}

{% capture map-link %}
https://davesredistricting.org/join/{{ state[label-lower] }}
{% endcapture %}
{% assign map-link = map-link | strip_newlines %}

{% assign intersections-label = label-lower | append: '-intersections' %}

{% capture intersections-link %}
https://davesredistricting.org/join/{{ state[intersections-label] }}
{% endcapture %}
{% assign intersections-link = intersections-link | strip_newlines %}

{% if map-exists in site.static_files %}
<div id="{{ label }}" class="tabcontent">
    <p>This is the {{ label-qualified }} map:</p>
    <p style="text-align: left">
        <a href="{{ map-link }}">
            <img src="{{ map-png }}" alt="Map" title="Click to view the map in Dave's Redistricting"
                width="{{ page.map-width }}" />
        </a>
    </p>

    <p>These are the intersections of the {{ label-lower }} districts with the baseline districts:</p>
    <p style="text-align: left">
        <a href="{{ intersections-link }}">
            <img src="{{ intersections-png }}" alt="Intersections" title="Click to view the map in Dave's Redistricting"
                width="{{ page.map-width }}" />
        </a>
    </p>

    <!-- Grid -->
    <div id="{{ label-lower }}-intersections-table" class="ag-theme-alpine">
    </div>

    <script type="text/javascript" charset="utf-8">
        const intersections{{ label }}Columns = [
            {headerName: 'ID', field: 'DISTRICT', width: 100, sortable: true, comparator: numericComparator, ...rightJustifiedColumn, unSortIcon: true},
            {headerName: 'Population', field: 'POPULATION', width: 150, valueFormatter: numberWithCommas, sortable: true, comparator: numericComparator, sortingOrder: ['desc', 'asc'], ...rightJustifiedColumn},
            {headerName: '% of District', field: 'DISTRICT%', width: 160, valueFormatter: percentage, sortable: true, comparator: numericComparator, sortingOrder: ['desc', 'asc'], ...rightJustifiedColumn},
            // {headerName: 'Cumulative %', field: 'CUMULATIVE%', width: 120, valueFormatter: percentage, ...rightJustifiedColumn},
        ];

        const intersections{{ label }}Options = {
            columnDefs: intersections{{ label }}Columns,
                domLayout: 'autoHeight',
                    onGridReady: (event) => {render{{ label }}Table(event.api)}
        };

        var eCoresGridDiv = document.getElementById('{{ label-lower }}-intersections-table');
        new agGrid.Grid(eCoresGridDiv, intersections{{ label }}Options);

        const intersections{{ label }}CSV = 'https://raw.githubusercontent.com/alecramsay/pg/main/docs/_data/{{ intersections-csv }}.csv';

        function render{{ label }}Table(api)
        {
            Papa.parse(intersections{{ label }}CSV, {
                header: true,
                download: true,
                complete: response =>
                {
                    data = response.data;
                    data.pop();
                    // console.log("Finished:", data);

                    api.setRowData(data);
                    api.sizeColumnsToFit();
                }
            })
        }
    </script>
</div>
{% else %}
<div id="{{ label }}" class="tabcontent">
    <p>There is no {{ label-qualified }} map.</p>
</div>
{% endif %}